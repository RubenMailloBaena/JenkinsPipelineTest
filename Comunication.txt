Actualizar microservicios desplegados sin tiempo de caída

El objetivo de esta POC es realizar una pipeline de Jenkins que nos permita actualizar un microservicio ya desplegado por una versión nueva y actualizada del mismo, teniendo en cuenta que no se debe perder servicio en ningún momento. Para ello emplearemos una técnica o estrategia, que comentaremos más adelante, llamada Blue-Green Deployment.

Antes que nada, comentaremos los distintos programas que hemos empleado. Para el despliegue de los microservicios usaremos WildFly, que es la versión comunitaria y gratuita de JBoss, un servidor de aplicaciones que nos permite desplegar nuestros microservicios.
También utilizaremos Nginx, un servidor web y proxy inverso de alto rendimiento, que nos permitirá actuar como intermediario entre el cliente y nuestro servicio, algo clave para esta POC.

Por último, las demás aplicaciones y tecnologías utilizadas son Jenkins, Spring Boot y GitHub. Cabe destacar que esta POC se ha realizado dentro de una máquina virtual de Oracle VM VirtualBox, con un sistema operativo Linux, por lo que los comandos de la pipeline pueden variar respecto a una realizada en Windows.

Se explicará paso a paso cómo se ha hecho todo el proceso para que pueda replicarse en caso de ser necesario. Primero se explicará cómo hacerlo de manera manual y, por último, se comentará el código de la pipeline, que automatiza todo el proceso.

MICRO-SERVICIO

Dicho esto, vamos a empezar con el microservicio de ejemplo que tenemos para esta POC. Este no es más que un RestController que nos permite consultar la versión actual del microservicio mediante el siguiente endpoint:

/version


Para ello, nuestro RestController se ve de la siguiente manera:

(código del controlador)

A continuación se muestra el código completo de la pipeline utilizada.
