Pipeline: pipeline {
    agent any
    
    parameters{
        base64File 'inputFile'
    }

    environment {
        REPO_URL = 'https://github.com/RubenMailloBaena/JenkinsPipelineTest.git'
        BRANCH = 'main'
        ARCHIVO = 'test.txt'
    }

    stages {
        stage('Prepare Workspace') {
            steps {
                script {
                    powershell '''
                        if (Test-Path -Path repo-temp) {
                            Remove-Item -Path repo-temp -Recurse -Force
                        }
                        mkdir repo-temp
                    '''
                }
            }
        }

        stage('Clonar archivo específico') { //git remote add origin ${REPO_URL} // git remote add origin https://${github-user}:${github-password}@${REPO_URL.replace("https://", "")}
            steps {
                script {
                    powershell """
                    cd repo-temp
                    git init
                    git remote add origin ${REPO_URL}
                    git config core.sparseCheckout true
                    "${ARCHIVO}" | Out-File -FilePath .git/info/sparse-checkout -Encoding ascii
                    git pull origin ${BRANCH}
                """
                }
            }
        }

        stage('Mostrar contenido de los archivos') {
            steps {
                script {
                    // MOSTRAR ARCHIVO DE GITHUB
                    powershell """
                        echo "=== GitHub File ==="
                        Get-Content .\\repo-temp\\${ARCHIVO}
                    """
                }
                
                script {
                   // Mostrar nombre del archivo
                    echo "=== Input File ==="
                    
                    withFileParameter('inputFile') {
                        powershell 'Get-Content -Path $env:inputFile'
                    }
                }
            }
        }
    }
}



-----------------------------------

pipeline {
    agent any

    parameters {
        file(name: 'inputFile', description: 'Archivo .txt que se imprimirá durante la build')
    }

    environment {
        REPO_URL = 'https://github.com/TU_USUARIO/TU_REPO.git'
        BRANCH = 'main'
        ARCHIVO = 'test.txt'
    }

    stages {

        stage('Preparar Workspace') {
            steps {
                script {
                    powershell '''
                        if (Test-Path -Path repo-temp) {
                            Remove-Item -Recurse -Force repo-temp
                        }
                        mkdir repo-temp
                    '''
                }
            }
        }

        stage('Clonar repositorio') {
            steps {
                dir('repo-temp') {
                    git branch: "${env.BRANCH}", url: "${env.REPO_URL}"
                }
            }
        }

        stage('Mostrar archivo del repo') {
            steps {
                powershell 'Get-Content .\\repo-temp\\' + ARCHIVO
            }
        }

        stage('Mostrar archivo input') {
            steps {
                withFileParameter('inputFile') {
                    powershell 'Get-Content "$env:inputFile"'
                }
            }
        }

        stage('Compilar con Ant') {
            steps {
                withFileParameter('inputFile') {
                    dir('repo-temp') {
                        powershell 'ant -Dinput.file="$env:inputFile"'
                    }
                }
            }
        }
    }
}
